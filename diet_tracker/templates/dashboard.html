{% extends 'base.html' %}
{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1 class="gradient-text mb-2">Your Fitness Dashboard</h1>
        <p class="text-dark">Welcome back, <strong class="text-primary">{{ current_user.username }}</strong>! Let's crush today's goals üí™</p>
    </div>
</div>

<!-- Stats Cards -->
<div class="row g-4 mb-4">
    <div class="col-md-3">
        <div class="stat-card" style="background: linear-gradient(135deg, #6366f1, #8b5cf6);">
            <div class="d-flex align-items-center">
                <div class="feature-icon icon-primary me-3">
                    <i class="fas fa-fire"></i>
                </div>
                <div>
                    <h2 class="mb-0 text-white">{{ tdee|int }}</h2>
                    <small class="text-white">TDEE (kcal/day)</small>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card" style="background: linear-gradient(135deg, #10b981, #059669);">
            <div class="d-flex align-items-center">
                <div class="feature-icon icon-success me-3">
                    <i class="fas fa-utensils"></i>
                </div>
                <div>
                    <h2 class="mb-0 text-white">{{ total_intakes }}</h2>
                    <small class="text-white">Total Logs</small>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
            <div class="d-flex align-items-center">
                <div class="feature-icon icon-warning me-3">
                    <i class="fas fa-chart-bar"></i>
                </div>
                <div>
                    <h2 class="mb-0 text-white">{{ avg_calories|int }}</h2>
                    <small class="text-white">Avg Calories</small>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card" style="background: linear-gradient(135deg, #ef4444, #dc2626);">
            <div class="d-flex align-items-center">
                <div class="feature-icon icon-danger me-3">
                    <i class="fas fa-trophy"></i>
                </div>
                <div>
                    <h2 class="mb-0 text-white">{{ streak }}</h2>
                    <small class="text-white">Day Streak üî•</small>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row g-4">
    <!-- Chart Card -->
    <div class="col-lg-8">
        <div class="glass-card p-4">
            <h4 class="gradient-text mb-3"><i class="fas fa-chart-area me-2"></i>Calorie Tracking</h4>
            <canvas id="caloriesChart" height="100"></canvas>
        </div>
    </div>

    <!-- Info Cards -->
    <div class="col-lg-4">
        <div class="glass-card p-4 mb-3">
            <h5 class="gradient-text"><i class="fas fa-apple-alt me-2"></i>Diet Type</h5>
            <p class="mb-2"><strong class="text-primary">{{ diet_type }}</strong></p>
            <small class="text-dark">Recommended based on your profile</small>
        </div>

        <div class="glass-card p-4 mb-3">
            <h5 class="gradient-text"><i class="fas fa-calendar-week me-2"></i>This Week</h5>
            <p class="mb-2"><strong class="text-success">{{ week_avg|int }} kcal</strong></p>
            <small class="text-dark">Average daily intake</small>
        </div>

        <div class="glass-card p-4">
            <h5 class="gradient-text"><i class="fas fa-bullseye me-2"></i>Quick Actions</h5>
            <div class="d-grid gap-2">
                <a href="{{ url_for('add_intake') }}" class="btn btn-gradient btn-lg">
                    <i class="fas fa-plus me-2"></i>Log Meal
                </a>
                <a href="{{ url_for('progress') }}" class="btn btn-outline-primary btn-lg">
                    <i class="fas fa-chart-pie me-2"></i>View Progress
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Motivational Quote -->
<div class="row mt-4">
    <div class="col-12">
        <div class="glass-card p-4 text-center" style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(236, 72, 153, 0.1));">
            <i class="fas fa-quote-left fa-2x gradient-text mb-3"></i>
            <h5 class="text-dark mb-3">"Success is the sum of small efforts repeated day in and day out."</h5>
            <p class="text-dark mb-0">Keep tracking, keep winning! üèÜ</p>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const ctx = document.getElementById('caloriesChart').getContext('2d');
new Chart(ctx, {
    type: 'line',
    data: {
        labels: {{ dates|tojson }},
        datasets: [{
            label: 'Daily Calories',
            data: {{ calories|tojson }},
            borderColor: '#6366f1',
            backgroundColor: 'rgba(99, 102, 241, 0.1)',
            tension: 0.4,
            fill: true,
            borderWidth: 3
        }, {
            label: 'TDEE Target',
            data: new Array({{ dates|tojson }}.length).fill({{ tdee|tojson }}),
            borderColor: '#10b981',
            borderDash: [5, 5],
            borderWidth: 2
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: {
                labels: { 
                    color: '#1e293b',
                    font: { 
                        weight: 'bold',
                        size: 12
                    }
                }
            },
            tooltip: {
                backgroundColor: 'rgba(255, 255, 255, 0.9)',
                titleColor: '#6366f1',
                bodyColor: '#1e293b',
                borderColor: '#6366f1',
                borderWidth: 1
            }
        },
        scales: {
            y: {
                ticks: {
                    color: '#1e293b',
                    font: {
                        weight: 'bold'
                    }
                },
                grid: {
                    color: 'rgba(30, 41, 59, 0.1)'
                }
            },
            x: {
                ticks: {
                    color: '#1e293b',
                    font: {
                        weight: 'bold'
                    }
                },
                grid: {
                    color: 'rgba(30, 41, 59, 0.1)'
                }
            }
        }
    }
});
</script>

<style>
    /* Update glass card for white background */
    .glass-card {
        background: rgba(255, 255, 255, 0.95) !important;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: var(--radius);
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        color: #1e293b !important;
    }
    
    /* Ensure all text is dark for white background */
    .text-dark {
        color: #1e293b !important;
    }
    
    /* Stat card styling */
    .stat-card {
        color: white;
        border-radius: var(--radius);
        padding: 1.5rem;
        transition: all 0.3s ease;
    }
    
    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 35px rgba(0,0,0,0.2);
    }
    
    .feature-icon {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
    }
    
    .icon-primary { 
        background: rgba(255, 255, 255, 0.2); 
        color: white; 
    }
    .icon-success { 
        background: rgba(255, 255, 255, 0.2); 
        color: white; 
    }
    .icon-warning { 
        background: rgba(255, 255, 255, 0.2); 
        color: white; 
    }
    .icon-danger { 
        background: rgba(255, 255, 255, 0.2); 
        color: white; 
    }
    
    .gradient-text {
        background: linear-gradient(135deg, #6366f1, #ec4899);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    
    .btn-gradient {
        background: linear-gradient(135deg, #6366f1, #ec4899);
        border: none;
        color: white;
        transition: all 0.3s ease;
    }
    
    .btn-gradient:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(99, 102, 241, 0.3);
        color: white;
    }
</style>
{% endblock %}